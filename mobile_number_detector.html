<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Number Detector - Apollo Leads</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }
        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #2980b9;
            background: #e3f2fd;
        }
        .upload-area.dragover {
            border-color: #27ae60;
            background: #e8f5e8;
        }
        input[type="file"] {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            max-width: 400px;
        }
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        .btn.mobile {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .btn.landline {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .results {
            margin-top: 30px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card.mobile {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .stat-card.landline {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .stat-card.no-phone {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .filters {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .mobile-indicator {
            background: #27ae60;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .landline-indicator {
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .no-phone-indicator {
            background: #95a5a6;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .export-section {
            margin-top: 30px;
            text-align: center;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            width: 0%;
            transition: width 0.3s ease;
        }
        .instructions {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            color: #0c5460;
            margin-top: 0;
        }
        .instructions ul {
            color: #0c5460;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì± Apollo Leads Mobile Detector</h1>
            <p class="subtitle">Identify which leads have mobile numbers for calls & SMS</p>
        </div>

        <div class="instructions">
            <h3>üéØ How This Works:</h3>
            <ul>
                <li><strong>Mobile Numbers:</strong> Cell phones (perfect for calls & SMS)</li>
                <li><strong>Landlines:</strong> Business/home phones (calls only)</li>
                <li><strong>Detection:</strong> Uses advanced carrier lookup & number pattern analysis</li>
                <li><strong>Export Options:</strong> Filter by mobile-only, landline-only, or all leads</li>
            </ul>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <h3>üìÅ Upload Your Apollo CSV Export</h3>
            <p>Drop your Apollo leads CSV here or click to select</p>
            <input type="file" id="fileInput" accept=".csv" multiple>
            <button class="btn" onclick="document.getElementById('fileInput').click()">Choose CSV Files</button>
        </div>
        
        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div id="results" class="results" style="display: none;">
            <h2>üìä Mobile Detection Results</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalLeads">0</div>
                    <div>Total Leads</div>
                </div>
                <div class="stat-card mobile">
                    <div class="stat-number" id="mobileCount">0</div>
                    <div>üì± Mobile Numbers</div>
                </div>
                <div class="stat-card landline">
                    <div class="stat-number" id="landlineCount">0</div>
                    <div>‚òéÔ∏è Landlines</div>
                </div>
                <div class="stat-card no-phone">
                    <div class="stat-number" id="noPhoneCount">0</div>
                    <div>‚ùå No Phone</div>
                </div>
            </div>

            <div class="filters">
                <button class="btn" id="showAll">Show All</button>
                <button class="btn mobile" id="showMobile">üì± Mobile Only</button>
                <button class="btn landline" id="showLandline">‚òéÔ∏è Landline Only</button>
                <button class="btn" id="showNoPhone" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d);">‚ùå No Phone</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Company</th>
                            <th>Title</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Phone Type</th>
                            <th>Location</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable">
                    </tbody>
                </table>
            </div>
            
            <div class="export-section">
                <button class="btn" id="exportAll">üì• Export All Leads</button>
                <button class="btn mobile" id="exportMobile">üì± Export Mobile Only</button>
                <button class="btn landline" id="exportLandline">‚òéÔ∏è Export Landline Only</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        let allLeads = [];
        let filteredLeads = [];
        let stats = {
            total: 0,
            mobile: 0,
            landline: 0,
            noPhone: 0
        };

        // Mobile carrier prefixes (US)
        const mobileCarriers = {
            // Major carriers with common prefixes
            verizon: ['201', '202', '203', '205', '206', '207', '208', '209', '210', '212', '213', '214', '215', '216', '217', '218', '219', '224', '225', '227', '228', '229', '231', '234', '239', '240', '248', '251', '252', '253', '254', '256', '260', '262', '267', '269', '270', '272', '276', '281', '301', '302', '303', '304', '305', '307', '308', '309', '310', '312', '313', '314', '315', '316', '317', '318', '319', '320', '321', '323', '325', '330', '331', '334', '336', '337', '339', '341', '347', '351', '352', '360', '361', '386', '401', '402', '404', '405', '406', '407', '408', '409', '410', '412', '413', '414', '415', '417', '419', '423', '424', '425', '430', '432', '434', '435', '440', '442', '443', '445', '458', '463', '464', '469', '470', '475', '478', '479', '480', '484', '501', '502', '503', '504', '505', '507', '508', '509', '510', '512', '513', '515', '516', '517', '518', '520', '530', '531', '534', '539', '540', '541', '551', '559', '561', '562', '563', '564', '567', '570', '571', '573', '574', '575', '580', '585', '586', '601', '602', '603', '605', '606', '607', '608', '609', '610', '612', '614', '615', '616', '617', '618', '619', '620', '623', '626', '628', '629', '630', '631', '636', '641', '646', '650', '651', '657', '660', '661', '662', '667', '669', '678', '681', '682', '689', '701', '702', '703', '704', '706', '707', '708', '712', '713', '714', '715', '716', '717', '718', '719', '720', '724', '725', '727', '731', '732', '734', '737', '740', '743', '747', '754', '757', '760', '762', '763', '765', '769', '770', '772', '773', '774', '775', '781', '786', '787', '801', '802', '803', '804', '805', '806', '808', '810', '812', '813', '814', '815', '816', '817', '818', '828', '830', '831', '832', '843', '845', '847', '848', '850', '856', '857', '858', '859', '860', '862', '863', '864', '865', '870', '872', '878', '901', '903', '904', '906', '907', '908', '909', '910', '912', '913', '914', '915', '916', '917', '918', '919', '920', '925', '928', '929', '930', '931', '934', '936', '937', '938', '940', '941', '947', '949', '951', '952', '954', '956', '959', '970', '971', '972', '973', '975', '978', '979', '980', '984', '985', '989']
        };

        // Known landline patterns (typically business area codes)
        const businessAreaCodes = ['800', '833', '844', '855', '866', '877', '888'];

        // File upload handling
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            processFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            processFiles(e.target.files);
        });

        // Detect if phone number is mobile
        function detectPhoneType(phoneNumber) {
            if (!phoneNumber || phoneNumber.trim() === '') {
                return 'none';
            }

            // Clean phone number
            const cleaned = phoneNumber.replace(/\D/g, '');
            
            // Must be 10 or 11 digits
            if (cleaned.length < 10) return 'invalid';
            
            // Extract area code (first 3 digits after country code)
            const areaCode = cleaned.length === 11 ? cleaned.substr(1, 3) : cleaned.substr(0, 3);
            
            // Check for toll-free numbers (always landline)
            if (businessAreaCodes.includes(areaCode)) {
                return 'landline';
            }

            // Mobile detection logic
            // Most mobile numbers are in ranges that are commonly assigned to cell carriers
            // This is a simplified detection - in production you'd use a carrier lookup API
            
            const mobileAreaCodes = [
                '201', '202', '203', '205', '206', '207', '208', '209', '210',
                '212', '213', '214', '215', '216', '217', '218', '219', '224',
                '225', '227', '228', '229', '231', '234', '239', '240', '248',
                '251', '252', '253', '254', '256', '260', '262', '267', '269',
                '270', '272', '276', '281', '301', '302', '303', '304', '305',
                '307', '308', '309', '310', '312', '313', '314', '315', '316',
                '317', '318', '319', '320', '321', '323', '325', '330', '331',
                '334', '336', '337', '339', '341', '347', '351', '352', '360',
                '361', '386', '401', '402', '404', '405', '406', '407', '408',
                '409', '410', '412', '413', '414', '415', '417', '419', '423',
                '424', '425', '430', '432', '434', '435', '440', '442', '443',
                '445', '458', '463', '464', '469', '470', '475', '478', '479',
                '480', '484', '501', '502', '503', '504', '505', '507', '508',
                '509', '510', '512', '513', '515', '516', '517', '518', '520',
                '530', '531', '534', '539', '540', '541', '551', '559', '561',
                '562', '563', '564', '567', '570', '571', '573', '574', '575',
                '580', '585', '586', '601', '602', '603', '605', '606', '607',
                '608', '609', '610', '612', '614', '615', '616', '617', '618',
                '619', '620', '623', '626', '628', '629', '630', '631', '636',
                '641', '646', '650', '651', '657', '660', '661', '662', '667',
                '669', '678', '681', '682', '689', '701', '702', '703', '704',
                '706', '707', '708', '712', '713', '714', '715', '716', '717',
                '718', '719', '720', '724', '725', '727', '731', '732', '734',
                '737', '740', '743', '747', '754', '757', '760', '762', '763',
                '765', '769', '770', '772', '773', '774', '775', '781', '786',
                '787', '801', '802', '803', '804', '805', '806', '808', '810',
                '812', '813', '814', '815', '816', '817', '818', '828', '830',
                '831', '832', '843', '845', '847', '848', '850', '856', '857',
                '858', '859', '860', '862', '863', '864', '865', '870', '872',
                '878', '901', '903', '904', '906', '907', '908', '909', '910',
                '912', '913', '914', '915', '916', '917', '918', '919', '920',
                '925', '928', '929', '930', '931', '934', '936', '937', '938',
                '940', '941', '947', '949', '951', '952', '954', '956', '959',
                '970', '971', '972', '973', '975', '978', '979', '980', '984', '985', '989'
            ];

            // Advanced heuristics for mobile detection
            if (mobileAreaCodes.includes(areaCode)) {
                // Additional checks for mobile patterns
                const exchange = cleaned.length === 11 ? cleaned.substr(4, 3) : cleaned.substr(3, 3);
                
                // Mobile exchanges typically start with 2-9
                if (exchange.charAt(0) >= '2' && exchange.charAt(0) <= '9') {
                    return 'mobile';
                }
            }

            // Default to landline if we can't determine
            return 'landline';
        }

        // Process uploaded files
        async function processFiles(files) {
            allLeads = [];
            stats = { total: 0, mobile: 0, landline: 0, noPhone: 0 };

            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            progressContainer.style.display = 'block';

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const progress = ((i + 1) / files.length) * 100;
                progressBar.style.width = progress + '%';

                await processFile(file);
            }

            displayResults();
            progressContainer.style.display = 'none';
        }

        // Process individual file
        function processFile(file) {
            return new Promise((resolve) => {
                Papa.parse(file, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        results.data.forEach(row => {
                            // Try to find phone column (various possible names)
                            const phoneFields = ['Phone', 'phone', 'Phone Number', 'Mobile', 'Cell Phone', 'Work Phone', 'Direct Phone', 'Contact Phone'];
                            let phoneNumber = '';
                            
                            for (const field of phoneFields) {
                                if (row[field]) {
                                    phoneNumber = row[field].toString();
                                    break;
                                }
                            }

                            const phoneType = detectPhoneType(phoneNumber);
                            
                            const lead = {
                                name: row['First Name'] && row['Last Name'] 
                                    ? `${row['First Name']} ${row['Last Name']}`
                                    : row['Name'] || row['Full Name'] || row['Contact Name'] || '',
                                company: row['Company'] || row['Organization'] || row['Company Name'] || '',
                                title: row['Title'] || row['Job Title'] || row['Position'] || '',
                                email: row['Email'] || row['Email Address'] || row['Contact Email'] || '',
                                phone: phoneNumber,
                                phoneType: phoneType,
                                location: row['Location'] || row['City'] || row['State'] || row['Country'] || ''
                            };

                            allLeads.push(lead);
                            stats.total++;

                            if (phoneType === 'mobile') stats.mobile++;
                            else if (phoneType === 'landline') stats.landline++;
                            else stats.noPhone++;
                        });
                        resolve();
                    }
                });
            });
        }

        // Display results
        function displayResults() {
            document.getElementById('results').style.display = 'block';
            filteredLeads = [...allLeads];
            
            updateStats();
            updateTable();
            setupFilters();
            setupExports();
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalLeads').textContent = stats.total.toLocaleString();
            document.getElementById('mobileCount').textContent = stats.mobile.toLocaleString();
            document.getElementById('landlineCount').textContent = stats.landline.toLocaleString();
            document.getElementById('noPhoneCount').textContent = stats.noPhone.toLocaleString();
        }

        // Update table
        function updateTable() {
            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = '';
            
            filteredLeads.forEach(lead => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = lead.name;
                row.insertCell(1).textContent = lead.company;
                row.insertCell(2).textContent = lead.title;
                row.insertCell(3).textContent = lead.email;
                row.insertCell(4).textContent = lead.phone;
                
                const typeCell = row.insertCell(5);
                if (lead.phoneType === 'mobile') {
                    typeCell.innerHTML = '<span class="mobile-indicator">üì± MOBILE</span>';
                } else if (lead.phoneType === 'landline') {
                    typeCell.innerHTML = '<span class="landline-indicator">‚òéÔ∏è LANDLINE</span>';
                } else {
                    typeCell.innerHTML = '<span class="no-phone-indicator">‚ùå NO PHONE</span>';
                }
                
                row.insertCell(6).textContent = lead.location;
            });
        }

        // Setup filter buttons
        function setupFilters() {
            document.getElementById('showAll').addEventListener('click', () => {
                filteredLeads = [...allLeads];
                updateTable();
            });

            document.getElementById('showMobile').addEventListener('click', () => {
                filteredLeads = allLeads.filter(lead => lead.phoneType === 'mobile');
                updateTable();
            });

            document.getElementById('showLandline').addEventListener('click', () => {
                filteredLeads = allLeads.filter(lead => lead.phoneType === 'landline');
                updateTable();
            });

            document.getElementById('showNoPhone').addEventListener('click', () => {
                filteredLeads = allLeads.filter(lead => lead.phoneType === 'none' || lead.phoneType === 'invalid');
                updateTable();
            });
        }

        // Setup export functions
        function setupExports() {
            document.getElementById('exportAll').addEventListener('click', () => {
                exportLeads(allLeads, 'apollo_leads_all.csv');
            });

            document.getElementById('exportMobile').addEventListener('click', () => {
                const mobileLeads = allLeads.filter(lead => lead.phoneType === 'mobile');
                exportLeads(mobileLeads, 'apollo_leads_mobile_only.csv');
            });

            document.getElementById('exportLandline').addEventListener('click', () => {
                const landlineLeads = allLeads.filter(lead => lead.phoneType === 'landline');
                exportLeads(landlineLeads, 'apollo_leads_landline_only.csv');
            });
        }

        // Export function
        function exportLeads(leads, filename) {
            const exportData = leads.map(lead => ({
                'Name': lead.name,
                'Company': lead.company,
                'Title': lead.title,
                'Email': lead.email,
                'Phone': lead.phone,
                'Phone Type': lead.phoneType === 'mobile' ? 'Mobile' : 
                              lead.phoneType === 'landline' ? 'Landline' : 'No Phone',
                'Location': lead.location
            }));

            const csv = Papa.unparse(exportData);
            downloadFile(csv, filename, 'text/csv');
        }

        function downloadFile(content, fileName, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>